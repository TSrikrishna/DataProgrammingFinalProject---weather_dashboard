<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            fetch('/api/weather')
                .then(response => response.json())
                .then(data => {
                    var temperatureData = new google.visualization.DataTable();
                    temperatureData.addColumn('datetime', 'Time');
                    temperatureData.addColumn('number', 'Temperature');
                    var humidityData = new google.visualization.DataTable();
                    humidityData.addColumn('datetime', 'Time');
                    humidityData.addColumn('number', 'Humidity');

                    var cities = {};

                    data.forEach(row => {
                        var city = row.city;
                        if (!cities[city]) {
                            cities[city] = { temp: [], humidity: [] };
                        }
                        cities[city].temp.push([new Date(row.minute), row.temperature]);
                        cities[city].humidity.push([new Date(row.minute), row.humidity]);
                    });

                    for (var city in cities) {
                        var tempOptions = {
                            title: 'Temperature Data for ' + city,
                            hAxis: { title: 'Time' },
                            vAxis: { title: 'Temperature (Â°C)' },
                            curveType: 'function',
                            legend: { position: 'bottom' },
                            series: { 0: { pointShape: 'circle', lineDashStyle: [4, 4] } }
                        };
                        var humidityOptions = {
                            title: 'Humidity Data for ' + city,
                            hAxis: { title: 'Time' },
                            vAxis: { title: 'Humidity (%)' },
                            legend: { position: 'bottom' },
                            series: { 0: { pointShape: 'circle' } }
                        };

                        var tempDiv = document.createElement('div');
                        tempDiv.style.width = '100%';
                        tempDiv.style.height = '500px';
                        document.body.appendChild(tempDiv);
                        var tempChart = new google.visualization.LineChart(tempDiv);
                        tempChart.draw(google.visualization.arrayToDataTable([[{ label: 'Time', type: 'datetime' }, 'Temperature']].concat(cities[city].temp)), tempOptions);

                        var humidityDiv = document.createElement('div');
                        humidityDiv.style.width = '100%';
                        humidityDiv.style.height = '500px';
                        document.body.appendChild(humidityDiv);
                        var humidityChart = new google.visualization.ColumnChart(humidityDiv);
                        humidityChart.draw(google.visualization.arrayToDataTable([[{ label: 'Time', type: 'datetime' }, 'Humidity']].concat(cities[city].humidity)), humidityOptions);
                    }
                });
        }
    </script>
</head>
<body>
    <h1>Weather Dashboard</h1>
</body>
</html>
