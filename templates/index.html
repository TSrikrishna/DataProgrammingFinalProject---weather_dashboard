<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            fetch('/api/weather')
                .then(response => response.json())
                .then(data => {
                    var temperatureDataBarrie = new google.visualization.DataTable();
                    temperatureDataBarrie.addColumn('datetime', 'Time');
                    temperatureDataBarrie.addColumn('number', 'Temperature');

                    var temperatureDataToronto = new google.visualization.DataTable();
                    temperatureDataToronto.addColumn('datetime', 'Time');
                    temperatureDataToronto.addColumn('number', 'Temperature');

                    var humidityDataBarrie = new google.visualization.DataTable();
                    humidityDataBarrie.addColumn('datetime', 'Time');
                    humidityDataBarrie.addColumn('number', 'Humidity');

                    var humidityDataToronto = new google.visualization.DataTable();
                    humidityDataToronto.addColumn('datetime', 'Time');
                    humidityDataToronto.addColumn('number', 'Humidity');

                    data.forEach(row => {
                        var date = new Date(row.minute);
                        if (row.city === 'Barrie') {
                            temperatureDataBarrie.addRow([date, parseFloat(row.temperature)]);
                            humidityDataBarrie.addRow([date, parseFloat(row.humidity)]);
                        } else if (row.city === 'Toronto') {
                            temperatureDataToronto.addRow([date, parseFloat(row.temperature)]);
                            humidityDataToronto.addRow([date, parseFloat(row.humidity)]);
                        }
                    });

                    var tempOptions = {
                        hAxis: { title: 'Time', format: 'HH:mm' },
                        vAxis: { title: 'Temperature (Â°C)' },
                        series: { 0: { lineWidth: 2, pointSize: 5 } },
                        legend: 'none'
                    };

                    var humOptions = {
                        hAxis: { title: 'Time', format: 'HH:mm' },
                        vAxis: { title: 'Humidity (%)' },
                        series: { 0: { lineWidth: 2, pointSize: 5 } },
                        legend: 'none'
                    };

                    var tempDivBarrie = document.getElementById('temperature_chart_barrie');
                    var tempChartBarrie = new google.visualization.LineChart(tempDivBarrie);
                    tempChartBarrie.draw(temperatureDataBarrie, tempOptions);

                    var tempDivToronto = document.getElementById('temperature_chart_toronto');
                    var tempChartToronto = new google.visualization.LineChart(tempDivToronto);
                    tempChartToronto.draw(temperatureDataToronto, tempOptions);

                    var humDivBarrie = document.getElementById('humidity_chart_barrie');
                    var humChartBarrie = new google.visualization.ColumnChart(humDivBarrie);
                    humChartBarrie.draw(humidityDataBarrie, humOptions);

                    var humDivToronto = document.getElementById('humidity_chart_toronto');
                    var humChartToronto = new google.visualization.ColumnChart(humDivToronto);
                    humChartToronto.draw(humidityDataToronto, humOptions);
                });
        }
    </script>
</head>
<body>
    <h1>Weather Dashboard</h1>
    <div id="temperature_chart_barrie" style="width: 100%; height: 500px;"></div>
    <div id="temperature_chart_toronto" style="width: 100%; height: 500px;"></div>
    <div id="humidity_chart_barrie" style="width: 100%; height: 500px;"></div>
    <div id="humidity_chart_toronto" style="width: 100%; height: 500px;"></div>
</body>
</html>
